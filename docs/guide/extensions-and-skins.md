# Extensions and skins

## Contents

- [Overview](#overview)
- [Bundled vs. user extensions](#bundled-vs-user-extensions)
- [Listing available extensions and skins](#listing-available-extensions-and-skins)
- [Enabling extensions and skins](#enabling-extensions-and-skins)
  - [Global vs. per-wiki](#global-vs-per-wiki)
  - [Enabling multiple at once](#enabling-multiple-at-once)
- [Disabling extensions and skins](#disabling-extensions-and-skins)
- [Adding extensions not bundled with Canasta](#adding-extensions-not-bundled-with-canasta)
  - [Composer dependencies](#composer-dependencies)
- [How it works under the hood](#how-it-works-under-the-hood)
- [Important notes](#important-notes)

---

## Overview

Canasta bundles over 100 extensions and skins. The CLI provides commands to enable and disable them without manually editing PHP files:

- `canasta extension list` — list available extensions
- `canasta extension enable` — enable one or more extensions
- `canasta extension disable` — disable one or more extensions
- `canasta skin list` — list available skins
- `canasta skin enable` — enable one or more skins
- `canasta skin disable` — disable one or more skins

See the [CLI Reference](../cli/canasta_extension.md) for the full list of flags and usage.

---

## Bundled vs. user extensions

Canasta distinguishes between two types of extensions and skins:

**Bundled extensions/skins** are included in the Canasta Docker image. Inside the container, they live in `canasta-extensions/` and `canasta-skins/`. These are the extensions listed by `canasta extension list` and `canasta skin list`, and are what the `enable`/`disable` commands manage.

**User extensions/skins** are extensions you add yourself. On the host, they go in the `extensions/` and `skins/` directories of your installation. These are not managed by the CLI — you load them by adding `wfLoadExtension()` or `wfLoadSkin()` calls in a settings file under `config/settings/`.

---

## Listing available extensions and skins

To see what bundled extensions are available:

```bash
canasta extension list -i myinstance
```

To see available skins:

```bash
canasta skin list -i myinstance
```

These commands list the names of all bundled extensions or skins shipped with the Canasta image. The installation must be running.

---

## Enabling extensions and skins

```bash
canasta extension enable VisualEditor -i myinstance
canasta skin enable Vector -i myinstance
```

### Global vs. per-wiki

By default, enabling an extension applies to **all wikis** in the installation. To enable an extension for a specific wiki only, use the `-w` flag:

```bash
# Enable for all wikis
canasta extension enable VisualEditor -i myinstance

# Enable for a specific wiki
canasta extension enable SemanticMediaWiki -i myinstance -w docs
```

Disabling works the same way — without `-w` it affects the global setting, with `-w` it affects that wiki only.

### Enabling multiple at once

Pass a comma-separated list of names:

```bash
canasta extension enable VisualEditor,Cite,Scribunto -i myinstance
canasta skin enable Vector,CologneBlue -i myinstance
```

Each extension is processed independently. If one name is invalid, the others are still enabled.

---

## Disabling extensions and skins

```bash
canasta extension disable VisualEditor -i myinstance
canasta skin disable CologneBlue -i myinstance -w docs
```

The CLI can only disable extensions that were enabled using the CLI. If you manually created a settings file to load an extension, the CLI will not remove it.

---

## Adding extensions not bundled with Canasta

To use an extension that is not included in the Canasta image:

1. Place the extension in the `extensions/` directory of your installation (or `skins/` for skins)
2. Create a PHP settings file to load it — either in `config/settings/global/` (for all wikis) or `config/settings/wikis/{wiki-id}/` (for a specific wiki):

```php
<?php
wfLoadExtension( 'MyCustomExtension' );
```

3. Restart the installation:

```bash
canasta restart -i myinstance
```

User extensions are not shown by `canasta extension list` and cannot be managed with `enable`/`disable`. They are loaded by the settings files you create.

### Composer dependencies

If a non-bundled extension requires Composer packages, add a reference to the extension's `composer.json` in `config/composer.local.json`:

```json
{
	"extra": {
		"merge-plugin": {
			"include": [
				"user-extensions/SomeExtension/composer.json"
			]
		}
	}
}
```

**Note:** Only the `extra.merge-plugin` section is used. The `require` section of `composer.local.json` is ignored — you cannot install new extensions via Composer, only their dependencies.

---

## How it works under the hood

When you run `canasta extension enable VisualEditor`, the CLI creates a small PHP file inside the container that loads the extension:

- **Global enable** creates `/mediawiki/config/settings/VisualEditor.php` containing:
  ```php
  <?php
  // This file was generated by Canasta
  wfLoadExtension( 'VisualEditor' );
  ```

- **Per-wiki enable** (`-w docs`) creates `/mediawiki/config/docs/VisualEditor.php` with the same content.

Disabling deletes that file. The CLI checks for the `// This file was generated by Canasta` comment before deleting, so it will not remove files you created manually.

Since these files are in the mounted `config/` volume, they persist across container restarts.

---

## Important notes

- **Extension and skin names are case-sensitive.** Use the exact name as shown by `canasta extension list` or `canasta skin list`.
- **The installation must be running.** The commands execute inside the web container, so containers must be up.
- **Enabling is idempotent.** Running `enable` on an already-enabled extension is a no-op.
- **Disable only works on CLI-managed extensions.** Manually created settings files are left alone.
- **No restart required.** Changes take effect on the next page load since PHP reads the settings files on each request.
